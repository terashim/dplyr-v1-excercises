---
title: 'dplyr ver1 ç·´ç¿’å¸³ - 10 "å‹•çš„ãª" åˆ—é¸æŠž `tidyselect` ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ç¾¤'
author: "terashim"
date: "2020/7/11"
output:
  md_document:
    variant: gfm
---

# 10 "å‹•çš„ãª" åˆ—é¸æŠž `tidyselect` ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ç¾¤

ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ãƒ­ãƒ¼ãƒ‰


```r
library(dplyr)
library(nycflights13)
```


`dplyr` v1.0.0 ã‚’ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã¨ã€[`tidyselect`](https://tidyselect.r-lib.org/) ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«å«ã¾ã‚Œã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ç¾¤ãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã‚‹ã€‚

ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã‚’åˆ©ç”¨ã™ã‚‹ã¨ `select()` é–¢æ•°ã§é¸æŠžã™ã‚‹åˆ—ã‚’æ§˜ã€…ãªåˆ¤å®šæ¡ä»¶ã§ "å‹•çš„ã«" æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
ã“ã‚Œã¯SQLã«ã¯ãªã„ç‰¹å¾´ã§ã‚ã‚‹ã€‚

ã“ã“ã§ã¯

- `where()`
- `starts_with()`
- `ends_with()`
- `contains()`
- `mathces()`
- `any_of()`

ã‚’å–ã‚Šä¸Šã’ã‚‹ã€‚


## ã€v1.0æ–°æ©Ÿèƒ½ã€‘ `where` ã¯ã€Œä½•ã€…ã§ã‚ã‚‹ã‚ˆã†ãªåˆ—ã€ã‚’é¸æŠžã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã™ã‚‹.

`select()` ã¨ `where()` ã§ `flights` ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰æ–‡å­—åˆ—åž‹ã§ã‚ã‚‹ã‚ˆã†ãªåˆ—ã‚’é¸æŠž


```r
flights %>% 
  select(where(is.character))
```

```
## # A tibble: 336,776 x 4
##    carrier tailnum origin dest 
##    <chr>   <chr>   <chr>  <chr>
##  1 UA      N14228  EWR    IAH  
##  2 UA      N24211  LGA    IAH  
##  3 AA      N619AA  JFK    MIA  
##  4 B6      N804JB  JFK    BQN  
##  5 DL      N668DN  LGA    ATL  
##  6 UA      N39463  EWR    ORD  
##  7 B6      N516JB  EWR    FLL  
##  8 EV      N829AS  LGA    IAD  
##  9 B6      N593JB  JFK    MCO  
## 10 AA      N3ALAA  LGA    ORD  
## # â€¦ with 336,766 more rows
```

SQLã®WHEREå¥ï¼ˆ`filter()` ã«ç›¸å½“ï¼‰ã¨ã¯ç•°ãªã‚‹ã®ã§å°‘ã—é•å’Œæ„ŸãŒã‚ã‚‹ã€‚

`is.character()` ã¯å„åˆ—ã«é©ç”¨ã™ã‚‹ã¨ `TRUE` ã¾ãŸã¯ `FALSE` ã‚’è¿”ã™ã€‚ `where()` ã«ã¯ã“ã®ã‚ˆã†ãªé–¢æ•°ã‚’ä¸Žãˆã‚‰ã‚Œã‚‹ã€‚


```r
is.character(flights$year)
```

```
## [1] FALSE
```

```r
is.character(flights$carrier)
```

```
## [1] TRUE
```

## è¤‡åˆæ¡ä»¶ã§åˆ—ã‚’é¸æŠž

`flights` ãƒ‡ãƒ¼ã‚¿ã®ä¸­ã‹ã‚‰ã€æ•°å€¤åž‹ã§ã€ã‹ã¤æœ€å¤§å€¤ãŒ 100 ä»¥ä¸‹ã§ã‚ã‚‹ã‚ˆã†ãªåˆ—ã‚’é¸æŠž


```r
flights %>% 
  select(where(~ is.numeric(.x) && max(.x, na.rm = TRUE) < 100))
```

```
## # A tibble: 336,776 x 4
##    month   day  hour minute
##    <int> <int> <dbl>  <dbl>
##  1     1     1     5     15
##  2     1     1     5     29
##  3     1     1     5     40
##  4     1     1     5     45
##  5     1     1     6      0
##  6     1     1     5     58
##  7     1     1     6      0
##  8     1     1     6      0
##  9     1     1     6      0
## 10     1     1     6      0
## # â€¦ with 336,766 more rows
```

## ã€œã€œã§å§‹ã¾ã‚‹åˆ—åã®åˆ—ã‚’é¸æŠž - `starts_with()`


```r
flights %>% 
  select(starts_with("dep"))
```

```
## # A tibble: 336,776 x 2
##    dep_time dep_delay
##       <int>     <dbl>
##  1      517         2
##  2      533         4
##  3      542         2
##  4      544        -1
##  5      554        -6
##  6      554        -4
##  7      555        -5
##  8      557        -3
##  9      557        -3
## 10      558        -2
## # â€¦ with 336,766 more rows
```

## ã€œã€œã§çµ‚ã‚ã‚‹åˆ—åã®åˆ—ã‚’é¸æŠž - `ends_with()`


```r
flights %>% 
  select(ends_with("time"))
```

```
## # A tibble: 336,776 x 5
##    dep_time sched_dep_time arr_time sched_arr_time air_time
##       <int>          <int>    <int>          <int>    <dbl>
##  1      517            515      830            819      227
##  2      533            529      850            830      227
##  3      542            540      923            850      160
##  4      544            545     1004           1022      183
##  5      554            600      812            837      116
##  6      554            558      740            728      150
##  7      555            600      913            854      158
##  8      557            600      709            723       53
##  9      557            600      838            846      140
## 10      558            600      753            745      138
## # â€¦ with 336,766 more rows
```

## ã€œã€œã«éƒ¨åˆ†ä¸€è‡´ã™ã‚‹åˆ—åã®åˆ—ã‚’é¸æŠž - `contains()`


```r
flights %>% 
  select(contains("dep"))
```

```
## # A tibble: 336,776 x 3
##    dep_time sched_dep_time dep_delay
##       <int>          <int>     <dbl>
##  1      517            515         2
##  2      533            529         4
##  3      542            540         2
##  4      544            545        -1
##  5      554            600        -6
##  6      554            558        -4
##  7      555            600        -5
##  8      557            600        -3
##  9      557            600        -3
## 10      558            600        -2
## # â€¦ with 336,766 more rows
```

## æ­£è¦è¡¨ç¾ã§ã€œã€œãƒžãƒƒãƒã™ã‚‹åˆ—åã®åˆ—ã‚’é¸æŠž - `matches()`


```r
flights %>% 
  select(matches("^(dep|arr)"))
```

```
## # A tibble: 336,776 x 4
##    dep_time dep_delay arr_time arr_delay
##       <int>     <dbl>    <int>     <dbl>
##  1      517         2      830        11
##  2      533         4      850        20
##  3      542         2      923        33
##  4      544        -1     1004       -18
##  5      554        -6      812       -25
##  6      554        -4      740        12
##  7      555        -5      913        19
##  8      557        -3      709       -14
##  9      557        -3      838        -8
## 10      558        -2      753         8
## # â€¦ with 336,766 more rows
```
## ã‚‚ã—ã€œã€œã¨ã„ã†åˆ—åãŒã‚ã‚Œã°é¸æŠž - `any_of()`

`select()` ã§å­˜åœ¨ã—ãªã„åˆ—ã‚’æŒ‡å®šã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹


```r
flights %>% 
  select(hour, minute, second)
```

```
## Error: Can't subset columns that don't exist.
## [31mâœ–[39m Column `second` doesn't exist.
```

ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•° `any_of()` ã‚’åˆ©ç”¨ã™ã‚‹ã¨ã€åˆ—åãŒå­˜åœ¨ã—ãªã„ã¨ãã¯ç„¡è¦–ã™ã‚‹ã‚ˆã†ã«ã§ãã‚‹


```r
flights %>% 
  select(any_of(c("hour", "minute", "second")))
```

```
## # A tibble: 336,776 x 2
##     hour minute
##    <dbl>  <dbl>
##  1     5     15
##  2     5     29
##  3     5     40
##  4     5     45
##  5     6      0
##  6     5     58
##  7     6      0
##  8     6      0
##  9     6      0
## 10     6      0
## # â€¦ with 336,766 more rows
```
